import{r as x,a as w}from"./vendor-CkDmySHI.js";const S=5,T=5e3;let g=0;function h(){return g=(g+1)%Number.MAX_SAFE_INTEGER,g.toString()}const f=new Map,m=t=>{if(f.has(t))return;const e=setTimeout(()=>{f.delete(t),c({type:"REMOVE_TOAST",toastId:t})},T);f.set(t,e)},y=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,S)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(a=>a.id===e.toast.id?{...a,...e.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=e;return a?m(a):t.toasts.forEach(r=>{m(r.id)}),{...t,toasts:t.toasts.map(r=>r.id===a||a===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(a=>a.id!==e.toastId)}}},d=[];let l={toasts:[]};function c(t){l=y(l,t),d.forEach(e=>{e(l)})}function i({...t}){const e=h(),a=o=>c({type:"UPDATE_TOAST",toast:{...o,id:e}}),r=()=>c({type:"DISMISS_TOAST",toastId:e});return c({type:"ADD_TOAST",toast:{...t,id:e,open:!0,onOpenChange:o=>{o||r()}}}),{id:e,dismiss:r,update:a}}function C(){const[t,e]=x.useState(l);return x.useEffect(()=>(d.push(e),()=>{const a=d.indexOf(e);a>-1&&d.splice(a,1)}),[t]),{...t,toast:i,dismiss:a=>c({type:"DISMISS_TOAST",toastId:a})}}const A=()=>localStorage.getItem("token"),_={success:t=>{i({title:"成功",description:t,variant:"default"})},error:t=>{i({title:"错误",description:t,variant:"destructive"})},warning:t=>{i({title:"警告",description:t,variant:"default"})},info:t=>{i({title:"提示",description:t,variant:"default"})}},s=w.create({baseURL:"/api/v1/",timeout:1e5,headers:{"Content-Type":"application/json",Accept:"application/json"}});s.interceptors.request.use(t=>{const e=A();return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));s.interceptors.response.use(t=>{if(t.data?.code===0)return t.data?.data||t.data?.detail||t.data||t;if(t.data?.code==401)return window.location.href="/login",Promise.reject("未登录或登录已过期，请重新登录。");const e=t.data?.detail||t.data,a=e?.message||"请求失败";if(t.headers["content-type"]==="application/json"&&e?.code!==40402)_.error(a);else return t.data;return Promise.reject(t.data)},t=>((t.status==401||t?.response?.status===401)&&(window.location.href="/login"),t?.response?.status===404,Promise.reject(t)));const D=t=>{const e=new URLSearchParams;return e.append("username",t.username),e.append("password",t.password),s.post("/wx/auth/login",e,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})};let n=0,p=0;const E=()=>new Promise((t,e)=>{n&&(clearInterval(n),n=0),p=0,s.get("/wx/auth/qr/code").then(a=>{n=setInterval(()=>{if(p++,p>500){clearInterval(n),n=0,e(new Error("获取二维码超时"));return}w.head(a?.code).then(o=>{o.status==200&&(console.log(o),clearInterval(n),t(a))}).catch(o=>{p>=500&&(clearInterval(n),e(o))})},1e3)}).catch(e)});let u=0;const P=()=>new Promise((t,e)=>{u&&(clearInterval(u),n=0),u=setInterval(()=>{s.get("wx/auth/qr/status").then(a=>{a?.login_status&&(_.success("授权成功"),clearInterval(u),t(a))}).catch(a=>{})},3e3)}),b=()=>s.post("/wx/auth/logout"),O=()=>s.get("/wx/user"),j=async()=>await s.get("/wx/sys/info"),R=async()=>await s.get("/wx/sys/resources"),q=t=>{const e=Array.isArray(t.format)?t.format:[];let a=[];t.scope==="selected"&&t.ids&&(a=t.ids.map(o=>String(o)).filter(o=>o&&o!=="undefined"&&o!=="null"&&o.trim()!=="")),console.log("exportArticles 参数:",{scope:t.scope,ids:t.ids,idsType:typeof t.ids,idsIsArray:Array.isArray(t.ids),doc_id:a,doc_idLength:a.length,mp_id:t.mp_id});const r={mp_id:t.mp_id||"",doc_id:a,page_size:t.page_size||10,page_count:t.page_count||1,add_title:t.add_title!==void 0?t.add_title:!0,remove_images:t.remove_images||!1,remove_links:t.remove_links||!1,export_md:e.includes("md"),export_docx:e.includes("docx"),export_json:e.includes("json"),export_csv:e.includes("csv"),export_pdf:e.includes("pdf"),zip_filename:t.zip_filename||""};if(console.log("exportArticles 请求数据:",{...r,doc_id:r.doc_id,doc_idLength:r.doc_id.length,doc_idValues:r.doc_id,doc_idStringified:JSON.stringify(r.doc_id)}),!r.export_md&&!r.export_docx&&!r.export_json&&!r.export_csv&&!r.export_pdf)throw new Error("请至少选择一个导出格式");return s.post("/wx/tools/export/articles",r,{headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})},U=t=>{const e={mp_id:t.mp_id};return s.get("/wx/tools/export/list",{params:e})},L=t=>{const e={mp_id:t.mp_id||"",filename:t.filename};return s.delete("/wx/tools/export/delete",{data:e})},I=t=>{const e={offset:(t.page||0)*(t.pageSize||10),limit:t.pageSize||10,search:t.search,status:t.status,mp_id:t.mp_id};return s.get("/wx/articles",{params:e})},$=(t,e)=>{switch(e){case-1:return s.get(`/wx/articles/${t}/prev`);case 1:return s.get(`/wx/articles/${t}/next`);default:return s.get(`/wx/articles/${t}`)}},v=t=>s.delete(`/wx/articles/${t}`),k=t=>s.post(`/wx/articles/${t}/fetch_content`),z=(t,e)=>s.put(`/wx/articles/${t}`,e),K=Object.freeze(Object.defineProperty({__proto__:null,deleteArticle:v,fetchArticleContent:k,getArticleDetail:$,getArticles:I,updateArticle:z},Symbol.toStringTag,{value:"Module"})),F=t=>{const e={offset:(t?.page||0)*(t?.pageSize||10),limit:t?.pageSize||10,kw:t?.kw||""};return s.get("/wx/mps",{params:e})},V=t=>s.post("/wx/mps",t),B=t=>s.post(`/wx/mps/by_article?url=${t}`),N=t=>s.delete(`/wx/mps/${t}`),Q=(t,e)=>{const a={start_page:0,end_page:e?.end_page};return s.get(`/wx/mps/update/${t||"all"}?start_page=${a.start_page}&end_page=${a.end_page}`)},X=(t,e)=>s.put(`/wx/mps/${t}`,e),J=(t,e)=>{const a={offset:0*e?.pageSize,limit:e?.pageSize};return s.get(`/wx/mps/search/${t}`,{params:a})},G=(t,e)=>{const a={kw:t||"",offset:(e?.page||0)*e?.pageSize,limit:e?.pageSize};return s.get("/wx/mps",{params:a})},H=()=>s.get("/wx/user"),W=t=>s.put("/wx/user",t),Y=t=>s.put("/wx/user/password",t,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),Z=t=>{const e=new FormData;return e.append("file",t),s.post("/wx/user/avatar",e,{headers:{"Content-Type":"multipart/form-data"}})},tt=()=>s.get("/wx/export/mps/export",{params:{limit:1e3,offset:0},responseType:"blob"}),et=t=>s.post("/wx/export/mps/import",t,{headers:{"Content-Type":"multipart/form-data"}}),st=()=>s.get("/wx/export/tags",{params:{limit:1e3,offset:0},responseType:"blob"}),at=t=>s.post("/wx/export/tags/import",t,{headers:{"Content-Type":"multipart/form-data"}}),rt=t=>{const e={offset:(t?.page||0)*(t?.pageSize||10),limit:t?.pageSize||10};return s.get("/wx/configs",{params:e})},ot=t=>s.get(`/wx/configs/${t}`),nt=t=>s.post("/wx/configs",t),it=(t,e)=>s.put(`/wx/configs/${t}`,e),ct=t=>s.delete(`/wx/configs/${t}`),pt=t=>{console.log(t);const e={offset:t?.offset||0,limit:t?.limit||10};return s.get("/wx/message_tasks",{params:e})},ut=t=>s.get(`/wx/message_tasks/${t}`),dt=(t,e=!1)=>s.get(`/wx/message_tasks/${t}/run?isTest=${e}`),lt=t=>s.post("/wx/message_tasks",t),gt=(t,e)=>s.put(`/wx/message_tasks/${t}`,e),ft=()=>s.put("/wx/message_tasks/job/fresh"),xt=t=>s.delete(`/wx/message_tasks/${t}`),mt=t=>s.get("/wx/tags",{params:{offset:0,limit:t?.limit}}),wt=t=>s.get(`/wx/tags/${t}`),_t=t=>s.post("/wx/tags",t),St=(t,e)=>s.put(`/wx/tags/${t}`,e),Tt=t=>s.delete(`/wx/tags/${t}`),ht=t=>{const e=t.map(a=>`tag_ids=${encodeURIComponent(a)}`).join("&");return s.delete(`/wx/tags?${e}`)},yt=t=>{const e=new FormData;return e.append("file",t),s.post("/wx/user/upload",e,{headers:{"Content-Type":"multipart/form-data"}})},At=()=>s.get("/wx/dashboard/stats"),It=t=>s.post("/wx/api-keys",t),$t=t=>{const e=t?.page??1,a=t?.pageSize??10;return s.get("/wx/api-keys",{params:{page:e,page_size:a}})},vt=(t,e)=>s.put(`/wx/api-keys/${t}`,e),kt=t=>s.delete(`/wx/api-keys/${t}`),zt=(t,e)=>{const a=e?.page??1,r=e?.pageSize??10;return s.get(`/wx/api-keys/${t}/logs`,{params:{page:a,page_size:r}})},Mt=t=>s.post(`/wx/api-keys/${t}/regenerate`);export{At as $,nt as A,ct as B,ot as C,L as D,tt as E,pt as F,ft as G,xt as H,et as I,G as J,ut as K,gt as L,_ as M,lt as N,R as O,mt as P,E as Q,dt as R,st as S,at as T,Q as U,Tt as V,ht as W,wt as X,yt as Y,St as Z,_t as _,j as a,$t as a0,zt as a1,vt as a2,It as a3,kt as a4,Mt as a5,K as a6,U as b,P as c,D as d,q as e,k as f,O as g,$ as h,F as i,I as j,v as k,b as l,z as m,Y as n,H as o,Z as p,W as q,B as r,J as s,V as t,C as u,N as v,A as w,X as x,rt as y,it as z};
