import{r as m,a as w}from"./vendor-B0TG5CS8.js";const T=5,h=5e3;let g=0;function S(){return g=(g+1)%Number.MAX_SAFE_INTEGER,g.toString()}const f=new Map,x=t=>{if(f.has(t))return;const e=setTimeout(()=>{f.delete(t),c({type:"REMOVE_TOAST",toastId:t})},h);f.set(t,e)},A=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,T)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(a=>a.id===e.toast.id?{...a,...e.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=e;return a?x(a):t.toasts.forEach(r=>{x(r.id)}),{...t,toasts:t.toasts.map(r=>r.id===a||a===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(a=>a.id!==e.toastId)}}},p=[];let l={toasts:[]};function c(t){l=A(l,t),p.forEach(e=>{e(l)})}function i({...t}){const e=S(),a=o=>c({type:"UPDATE_TOAST",toast:{...o,id:e}}),r=()=>c({type:"DISMISS_TOAST",toastId:e});return c({type:"ADD_TOAST",toast:{...t,id:e,open:!0,onOpenChange:o=>{o||r()}}}),{id:e,dismiss:r,update:a}}function D(){const[t,e]=m.useState(l);return m.useEffect(()=>(p.push(e),()=>{const a=p.indexOf(e);a>-1&&p.splice(a,1)}),[t]),{...t,toast:i,dismiss:a=>c({type:"DISMISS_TOAST",toastId:a})}}const y=()=>localStorage.getItem("token"),_={success:t=>{i({title:"成功",description:t,variant:"default"})},error:t=>{i({title:"错误",description:t,variant:"destructive"})},warning:t=>{i({title:"警告",description:t,variant:"default"})},info:t=>{i({title:"提示",description:t,variant:"default"})}},s=w.create({baseURL:"/api/v1/",timeout:1e5,headers:{"Content-Type":"application/json",Accept:"application/json"}});s.interceptors.request.use(t=>{const e=y();return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));s.interceptors.response.use(t=>{if(t.data?.code===0)return t.data?.data||t.data?.detail||t.data||t;if(t.data?.code==401)return window.location.href="/login",Promise.reject("未登录或登录已过期，请重新登录。");const e=t.data?.detail||t.data,a=e?.message||"请求失败";if(t.headers["content-type"]==="application/json"&&e?.code!==40402)_.error(a);else return t.data;return Promise.reject(t.data)},t=>((t.status==401||t?.response?.status===401)&&(window.location.href="/login"),t?.response?.status===404,Promise.reject(t)));const E=t=>{const e=new URLSearchParams;return e.append("username",t.username),e.append("password",t.password),s.post("/wx/auth/login",e,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})};let n=0,d=0;const P=()=>new Promise((t,e)=>{n&&(clearInterval(n),n=0),d=0,s.get("/wx/auth/qr/code").then(a=>{n=setInterval(()=>{if(d++,d>500){clearInterval(n),n=0,e(new Error("获取二维码超时"));return}w.head(a?.code).then(o=>{o.status==200&&(console.log(o),clearInterval(n),t(a))}).catch(o=>{d>=500&&(clearInterval(n),e(o))})},1e3)}).catch(e)});let u=0;const b=()=>new Promise((t,e)=>{u&&(clearInterval(u),n=0),u=setInterval(()=>{s.get("wx/auth/qr/status").then(a=>{a?.login_status&&(_.success("授权成功"),clearInterval(u),t(a))}).catch(a=>{})},3e3)}),O=()=>s.post("/wx/auth/logout"),z=()=>s.get("/wx/user"),j=async()=>await s.get("/wx/sys/info"),R=async()=>await s.get("/wx/sys/resources"),q=t=>{const e=Array.isArray(t.format)?t.format:[];let a=[];t.scope==="selected"&&t.ids&&(a=t.ids.map(o=>String(o)).filter(o=>o&&o!=="undefined"&&o!=="null"&&o.trim()!=="")),console.log("exportArticles 参数:",{scope:t.scope,ids:t.ids,idsType:typeof t.ids,idsIsArray:Array.isArray(t.ids),doc_id:a,doc_idLength:a.length,mp_id:t.mp_id});const r={mp_id:t.mp_id||"",doc_id:a,page_size:t.page_size||10,page_count:t.page_count||1,add_title:t.add_title!==void 0?t.add_title:!0,remove_images:t.remove_images||!1,remove_links:t.remove_links||!1,export_md:e.includes("md"),export_docx:e.includes("docx"),export_json:e.includes("json"),export_csv:e.includes("csv"),export_pdf:e.includes("pdf"),zip_filename:t.zip_filename||""};if(console.log("exportArticles 请求数据:",{...r,doc_id:r.doc_id,doc_idLength:r.doc_id.length,doc_idValues:r.doc_id,doc_idStringified:JSON.stringify(r.doc_id)}),!r.export_md&&!r.export_docx&&!r.export_json&&!r.export_csv&&!r.export_pdf)throw new Error("请至少选择一个导出格式");return s.post("/wx/tools/export/articles",r,{headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})},U=t=>{const e={mp_id:t.mp_id};return s.get("/wx/tools/export/list",{params:e})},L=t=>{const e={mp_id:t.mp_id||"",filename:t.filename};return s.delete("/wx/tools/export/delete",{data:e})},I=t=>{const e={offset:(t.page||0)*(t.pageSize||10),limit:t.pageSize||10,search:t.search,status:t.status,mp_id:t.mp_id};return s.get("/wx/articles",{params:e})},v=(t,e)=>{switch(e){case-1:return s.get(`/wx/articles/${t}/prev`);case 1:return s.get(`/wx/articles/${t}/next`);default:return s.get(`/wx/articles/${t}`)}},$=t=>s.delete(`/wx/articles/${t}`),k=t=>s.post(`/wx/articles/${t}/fetch_content`),M=(t,e)=>s.put(`/wx/articles/${t}`,e),F=Object.freeze(Object.defineProperty({__proto__:null,deleteArticle:$,fetchArticleContent:k,getArticleDetail:v,getArticles:I,updateArticle:M},Symbol.toStringTag,{value:"Module"})),V=t=>{const e={offset:(t?.page||0)*(t?.pageSize||10),limit:t?.pageSize||10,kw:t?.kw||""};return s.get("/wx/mps",{params:e})},B=t=>s.post("/wx/mps",t),N=t=>s.post(`/wx/mps/by_article?url=${t}`),Q=t=>s.delete(`/wx/mps/${t}`),X=(t,e)=>{const a={start_page:0,end_page:e?.end_page};return s.get(`/wx/mps/update/${t||"all"}?start_page=${a.start_page}&end_page=${a.end_page}`)},J=(t,e)=>s.put(`/wx/mps/${t}`,e),G=(t,e)=>{const a={offset:0*e?.pageSize,limit:e?.pageSize};return s.get(`/wx/mps/search/${t}`,{params:a})},H=(t,e)=>{const a={kw:t||"",offset:(e?.page||0)*e?.pageSize,limit:e?.pageSize};return s.get("/wx/mps",{params:a})},W=()=>s.get("/wx/user"),Y=t=>s.put("/wx/user",t),K=t=>s.put("/wx/user/password",t,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),Z=t=>{const e=new FormData;return e.append("file",t),s.post("/wx/user/avatar",e,{headers:{"Content-Type":"multipart/form-data"}})},tt=()=>s.get("/wx/export/mps/export",{params:{limit:1e3,offset:0},responseType:"blob"}),et=t=>s.post("/wx/export/mps/import",t,{headers:{"Content-Type":"multipart/form-data"}}),st=()=>s.get("/wx/export/tags",{params:{limit:1e3,offset:0},responseType:"blob"}),at=t=>s.post("/wx/export/tags/import",t,{headers:{"Content-Type":"multipart/form-data"}}),rt=t=>{const e={offset:(t?.page||0)*(t?.pageSize||10),limit:t?.pageSize||10};return s.get("/wx/configs",{params:e})},ot=t=>s.get(`/wx/configs/${t}`),nt=t=>s.post("/wx/configs",t),it=(t,e)=>s.put(`/wx/configs/${t}`,e),ct=t=>s.delete(`/wx/configs/${t}`),dt=t=>{console.log(t);const e={offset:t?.offset||0,limit:t?.limit||10};return s.get("/wx/message_tasks",{params:e})},ut=t=>s.get(`/wx/message_tasks/${t}`),pt=(t,e=!1)=>s.get(`/wx/message_tasks/${t}/run?isTest=${e}`),lt=t=>s.post("/wx/message_tasks",t),gt=(t,e)=>s.put(`/wx/message_tasks/${t}`,e),ft=()=>s.put("/wx/message_tasks/job/fresh"),mt=t=>s.delete(`/wx/message_tasks/${t}`),xt=t=>s.get("/wx/tags",{params:{offset:0,limit:t?.limit}}),wt=t=>s.get(`/wx/tags/${t}`),_t=t=>s.post("/wx/tags",t),Tt=(t,e)=>s.put(`/wx/tags/${t}`,e),ht=t=>s.delete(`/wx/tags/${t}`),St=t=>{const e=t.map(a=>`tag_ids=${encodeURIComponent(a)}`).join("&");return s.delete(`/wx/tags?${e}`)},At=t=>{const e=new FormData;return e.append("file",t),s.post("/wx/user/upload",e,{headers:{"Content-Type":"multipart/form-data"}})},yt=()=>s.get("/wx/dashboard/stats");export{yt as $,nt as A,ct as B,ot as C,L as D,tt as E,dt as F,ft as G,mt as H,et as I,H as J,ut as K,gt as L,_ as M,lt as N,R as O,xt as P,P as Q,pt as R,st as S,at as T,X as U,ht as V,St as W,wt as X,At as Y,Tt as Z,_t as _,j as a,F as a0,U as b,b as c,E as d,q as e,k as f,z as g,v as h,V as i,I as j,$ as k,O as l,M as m,K as n,W as o,Z as p,Y as q,N as r,G as s,B as t,D as u,Q as v,y as w,J as x,rt as y,it as z};
